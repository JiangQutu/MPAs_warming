---
title: "MPA and future temperature change study"
output: html_notebook
author: Mark Ruddy 
date: 2017-04-20
---


## Task summary

The project aims to look at projected climate warming in Marine Protected Areas. It uses climate models ([CMIP5](http://cmip-pcmdi.llnl.gov/cmip5/)) run for two emission scenarios (Representative Concentration Pathways - [RCPs](https://www.skepticalscience.com/rcp.php?t=1)) - 4.5degC and 8.5degC - developed as part of Intergovernmental Panel on Climate Change's (IPCC) Fifth Assessment Report ([AR5](http://www.ipcc-data.org/sim/gcm_monthly/AR5/)).

As part of the study, the temperature data need to be modified to exclude land-based temperature measures. Additionally, adequate maps of the data need to be created.

This notebook will provide:

1. A section of code that removes the land-based temperatures from the ICPP surface temperature rasters.
2. Plots of SST with land surface removed (white or black) and a pleasing SST key.

## Study setup

```{r}
# Packages
library(dplyr) # Data wrangling and exploration
library(raster) # Dealing with rasters
library(ncdf4) # Required - climate data in NetCDF format
```

## Datasets

Marine Protected Areas

```{r}
mpas <- read.csv("../nn_extractedA2c.csv", header = TRUE)
glimpse(mpas)
```

RCP8.5
```{r}
map.extent <- c(-180, 180, -90, 90) # Reset for layer, orginal orientation was 0-360 longitude
mean85 <- raster("../trend_yearmean_ensemble_tos_RCP85.nc")
extent(mean85) <- map.extent

source("../revrotate..R") # Rotate raster layer to align with MPA points
mean85 <- revrotate(mean85)
extent(mean85) <- map.extent

# glimpse(mean85)
```

## Plotting

Test plot temperature raster and MPAs - baseR
```{r}
plot(mean85) # Uses the default palette `col= rev(terrain.colors(255))` from`raster::plot`
points(mpas[,2:3], pch = 10, cex = 0.3) 
```

Test plot temperature raster and MPAs - rasterVis

```{r}
# library(rasterVis) # Plotting rasters 
pts <- mpas[,2:3] # MPA points
levelplot(mean85, margin = FALSE, par.settings = viridisTheme()) + 
  layer(sp.points(pts, pch = 10, cex = 0.3))
# ERROR THROWN: 'Error using packet 1 any(sp) is not TRUE'
# Problem somehwere with plotting points as `latticeExtra::layer` 
# Can't find solution at moment so will abandon using `rasterVis`
```


Test plot temperature raster and MPAs - ggplot2

```{r}
# library(ggplot2) # Graphics
# library(viridis) # viridis colour scales for perceptually uniform palettes. See https://cran.r-project.org/web/packages/viridis/vignettes/intro-to-viridis.html

gplot(mean85) +
  geom_raster(aes(fill = value)) +
  scale_fill_viridis(direction = -1, option = "plasma", breaks = seq(0.02, 0.16, 0.02)) +
  geom_point(data = mpas, mapping = aes(x = Centroid_Longitude, y = Centroid_Latitude), size = 0.1, colour = "black") + 
  guides(fill = guide_colorbar(title = NULL, barheight = 16, raster = TRUE)) +
  ggtitle("RCP 8.5 warming rate for mean SST") + 
  xlab("Longitude") +
  ylab("Latitude") +
  scale_y_continuous(breaks = seq(-80, 80, 40), expand = c(0,0)) +
  scale_x_continuous(breaks = seq(-180, 180, 60), expand = c(0,0))
```



## Remove land-based temperatures

Check out:

http://neondataskills.org/R/Raster-Data-In-R/





Read in Natural Earth 1:110m world vector, then convert to simple raster.

```{r}
# library(httr) # Make web requests
packrat::clean()
# Natural Earth 110m data
url <- "http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/110m/physical/ne_110m_land.zip"

```


























